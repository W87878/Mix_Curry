// 台灣行政區域完整資料
const taiwanDistricts = {
  "台北市": {
    townships: ["中正區", "大同區", "中山區", "松山區", "大安區", "萬華區", "信義區", "士林區", "北投區", "內湖區", "南港區", "文山區"],
    villages: {
      "中正區": ["城中里", "梅花里", "建國里", "黎明里", "幸市里", "文祥里", "龍福里", "永昌里", "光復里", "新營里"],
      "大同區": ["光能里", "昌吉里", "重慶里", "南芳里", "大有里", "朝陽里", "隆和里", "國順里", "老師里", "雙連里"],
      "中山區": ["中山里", "恆安里", "行仁里", "中央里", "康樂里", "松江里", "埤頭里", "大直里", "劍潭里", "圓山里"],
      "松山區": ["松山里", "東榮里", "東昌里", "莊敬里", "精忠里", "三民里", "新東里", "新益里", "慈祐里", "富泰里"],
      "大安區": ["學府里", "建安里", "龍門里", "龍坡里", "龍雲里", "大學里", "民炯里", "龍泉里", "敦安里", "群英里"],
      "萬華區": ["新忠里", "糖廍里", "雙園里", "孝德里", "福音里", "莒光里", "日善里", "和德里", "頂碩里", "青山里"],
      "信義區": ["三張犁里", "五常里", "六合里", "永春里", "中行里", "安康里", "黎平里", "黎順里", "敦厚里", "西村里"],
      "士林區": ["福林里", "陽明里", "天母里", "德行里", "義信里", "蘭雅里", "福佳里", "名山里", "聖山里", "芝山里"],
      "北投區": ["中心里", "長安里", "中央里", "大同里", "文化里", "溫泉里", "中庸里", "林泉里", "大屯里", "秀山里"],
      "內湖區": ["內湖里", "湖元里", "西湖里", "西康里", "港華里", "港墘里", "港富里", "港都里", "石潭里", "金湖里"],
      "南港區": ["南港里", "三重里", "東新里", "東明里", "西新里", "中南里", "聯成里", "新富里", "新光里", "玉成里"],
      "文山區": ["木柵里", "興光里", "興昌里", "興家里", "興安里", "興邦里", "興福里", "興旺里", "興得里", "順興里"]
    }
  },
  "新北市": {
    townships: ["板橋區", "三重區", "中和區", "永和區", "新莊區", "新店區", "樹林區", "鶯歌區", "三峽區", "淡水區", "汐止區", "瑞芳區", "土城區", "蘆洲區", "五股區", "泰山區", "林口區", "深坑區", "石碇區", "坪林區", "三芝區", "石門區", "八里區", "平溪區", "雙溪區", "貢寮區", "金山區", "萬里區", "烏來區"],
    villages: {
      "板橋區": ["溪北里", "溪洲里", "溪福里", "港德里", "港尾里", "埔墘里", "新翠里", "社後里", "香社里", "大安里"],
      "三重區": ["大有里", "大德里", "五福里", "田中里", "幸福里", "谷王里", "奕壽里", "長元里", "長江里", "長安里"],
      "中和區": ["中山里", "中正里", "中原里", "安平里", "安樂里", "安和里", "安邦里", "安穗里", "景安里", "景平里"]
      // 更多區域...
    }
  },
  "桃園市": {
    townships: ["桃園區", "中壢區", "平鎮區", "八德區", "楊梅區", "蘆竹區", "大溪區", "龍潭區", "龜山區", "大園區", "觀音區", "新屋區", "復興區"],
    villages: {
      "桃園區": ["文中里", "文化里", "文明里", "文昌里", "中山里", "中正里", "中和里", "中信里", "中原里", "中成里"],
      "中壢區": ["中山里", "中央里", "中正里", "中建里", "中榮里", "中堅里", "中興里", "仁福里", "仁愛里", "仁德里"]
      // 更多區域...
    }
  },
  "台中市": {
    townships: ["中區", "東區", "南區", "西區", "北區", "北屯區", "西屯區", "南屯區", "太平區", "大里區", "霧峰區", "烏日區", "豐原區", "后里區", "石岡區", "東勢區", "和平區", "新社區", "潭子區", "大雅區", "神岡區", "大肚區", "沙鹿區", "龍井區", "梧棲區", "清水區", "大甲區", "外埔區", "大安區"],
    villages: {
      "中區": ["中華里", "大墩里", "光復里", "柳川里", "繼光里", "綠川里", "公園里", "建國里"]
      // 更多區域...
    }
  },
  "台南市": {
    townships: ["中西區", "東區", "南區", "北區", "安平區", "安南區", "永康區", "歸仁區", "新化區", "左鎮區", "玉井區", "楠西區", "南化區", "仁德區", "關廟區", "龍崎區", "官田區", "麻豆區", "佳里區", "西港區", "七股區", "將軍區", "學甲區", "北門區", "新營區", "後壁區", "白河區", "東山區", "六甲區", "下營區", "柳營區", "鹽水區", "善化區", "大內區", "山上區", "新市區", "安定區"],
    villages: {
      "中西區": ["仙草里", "光賢里", "協和里", "協進里", "南美里", "南門里", "城隍里", "大涼里", "大南里", "大和里"],
      "東區": ["大同里", "大智里", "大福里", "小東里", "中西里", "仁和里", "文聖里", "成大里", "東光里", "東安里"]
      // 更多區域...
    }
  },
  "高雄市": {
    townships: ["新興區", "前金區", "苓雅區", "鹽埕區", "鼓山區", "旗津區", "前鎮區", "三民區", "楠梓區", "小港區", "左營區", "仁武區", "大社區", "東沙群島", "南沙群島", "岡山區", "路竹區", "阿蓮區", "田寮區", "燕巢區", "橋頭區", "梓官區", "彌陀區", "永安區", "湖內區", "鳳山區", "大寮區", "林園區", "鳥松區", "大樹區", "旗山區", "美濃區", "六龜區", "內門區", "杉林區", "甲仙區", "桃源區", "那瑪夏區", "茂林區", "茄萣區"],
    villages: {
      "新興區": ["大明里", "文昌里", "振成里", "秋山里", "建興里", "德生里", "德望里", "浩然里", "漢民里", "開平里"],
      "前金區": ["三川里", "文東里", "文西里", "北金里", "長生里", "長城里", "青山里", "榮復里", "後金里"]
      // 更多區域...
    }
  },
  "基隆市": {
    townships: ["中正區", "七堵區", "暖暖區", "仁愛區", "中山區", "安樂區", "信義區"],
    villages: {
      "中正區": ["中正里", "入船里", "八斗里", "正義里", "正砂里", "正濱里", "民族里", "信義里", "建國里", "砂子里"],
      "七堵區": ["七堵里", "八德里", "六堵里", "友一里", "友二里", "正光里", "正明里", "瑪西里", "瑪東里", "長安里"]
      // 更多區域...
    }
  },
  "新竹市": {
    townships: ["東區", "北區", "香山區"],
    villages: {
      "東區": ["千甲里", "仙水里", "仙宮里", "光復里", "光鎮里", "公園里", "建功里", "建華里", "復中里", "柴橋里"],
      "北區": ["中央里", "中雅里", "中寮里", "中興里", "中興里", "文雅里", "石坊里", "光田里", "光華里", "南勢里"],
      "香山區": ["中埔里", "內湖里", "茄苳里", "虎山里", "頂埔里", "頂福里", "朝山里", "港南里", "港北里", "鹽水里"]
    }
  },
  "嘉義市": {
    townships: ["東區", "西區"],
    villages: {
      "東區": ["中央里", "中山里", "中義里", "仁義里", "光路里", "公平里", "安業里", "宣信里", "崇文里", "後湖里"],
      "西區": ["下埤里", "中和里", "中興里", "仁和里", "保生里", "保福里", "劉厝里", "北新里", "北湖里", "後驛里"]
    }
  },
  "花蓮縣": {
    townships: ["花蓮市", "鳳林鎮", "玉里鎮", "新城鄉", "吉安鄉", "壽豐鄉", "光復鄉", "豐濱鄉", "瑞穗鄉", "富里鄉", "秀林鄉", "萬榮鄉", "卓溪鄉"],
    villages: {
      "花蓮市": ["主和里", "主安里", "主勤里", "主睦里", "主學里", "主權里", "民主里", "民生里", "民治里", "民政里"],
      "鳳林鎮": ["北林里", "大榮里", "山興里", "森榮里", "鳳仁里", "鳳信里", "鳳智里", "鳳禮里", "長橋里"],
      "玉里鎮": ["中城里", "仁愛里", "光復里", "國武里", "大禹里", "客城里", "源城里", "觀音里", "長良里", "高寮里"]
      // 更多區域...
    }
  },
  "宜蘭縣": {
    townships: ["宜蘭市", "頭城鎮", "礁溪鄉", "壯圍鄉", "員山鄉", "羅東鎮", "三星鄉", "大同鄉", "五結鄉", "冬山鄉", "蘇澳鎮", "南澳鄉"],
    villages: {
      "宜蘭市": ["七張里", "中山里", "北門里", "民權里", "西門里", "南門里", "延平里", "建業里", "梅洲里", "負郭里"],
      "羅東鎮": ["仁和里", "仁愛里", "北成里", "南豪里", "國華里", "大新里", "成功里", "浮崙里", "維揚里", "羅莊里"]
      // 更多區域...
    }
  },
  "苗栗縣": {
    townships: ["苗栗市", "頭份市", "竹南鎮", "後龍鎮", "通霄鎮", "苑裡鎮", "卓蘭鎮", "造橋鄉", "西湖鄉", "頭屋鄉", "公館鄉", "銅鑼鄉", "三義鄉", "大湖鄉", "獅潭鄉", "三灣鄉", "南庄鄉", "泰安鄉"],
    villages: {}
  },
  "彰化縣": {
    townships: ["彰化市", "員林市", "和美鎮", "鹿港鎮", "溪湖鎮", "二林鎮", "田中鎮", "北斗鎮", "花壇鄉", "芬園鄉", "大村鄉", "永靖鄉", "伸港鄉", "線西鄉", "福興鄉", "秀水鄉", "埔心鄉", "埔鹽鄉", "大城鄉", "芳苑鄉", "竹塘鄉", "社頭鄉", "二水鄉", "田尾鄉", "埤頭鄉", "溪州鄉"],
    villages: {}
  },
  "南投縣": {
    townships: ["南投市", "埔里鎮", "草屯鎮", "竹山鎮", "集集鎮", "名間鄉", "鹿谷鄉", "中寮鄉", "魚池鄉", "國姓鄉", "水里鄉", "信義鄉", "仁愛鄉"],
    villages: {}
  },
  "雲林縣": {
    townships: ["斗六市", "斗南鎮", "虎尾鎮", "西螺鎮", "土庫鎮", "北港鎮", "古坑鄉", "大埤鄉", "莿桐鄉", "林內鄉", "二崙鄉", "崙背鄉", "麥寮鄉", "東勢鄉", "褒忠鄉", "台西鄉", "元長鄉", "四湖鄉", "口湖鄉", "水林鄉"],
    villages: {}
  },
  "嘉義縣": {
    townships: ["太保市", "朴子市", "布袋鎮", "大林鎮", "民雄鄉", "溪口鄉", "新港鄉", "六腳鄉", "東石鄉", "義竹鄉", "鹿草鄉", "水上鄉", "中埔鄉", "竹崎鄉", "梅山鄉", "番路鄉", "大埔鄉", "阿里山鄉"],
    villages: {}
  },
  "屏東縣": {
    townships: ["屏東市", "潮州鎮", "東港鎮", "恆春鎮", "萬丹鄉", "長治鄉", "麟洛鄉", "九如鄉", "里港鄉", "鹽埔鄉", "高樹鄉", "萬巒鄉", "內埔鄉", "竹田鄉", "新埤鄉", "枋寮鄉", "新園鄉", "崁頂鄉", "林邊鄉", "南州鄉", "佳冬鄉", "琉球鄉", "車城鄉", "滿州鄉", "枋山鄉", "三地門鄉", "霧台鄉", "瑪家鄉", "泰武鄉", "來義鄉", "春日鄉", "獅子鄉", "牡丹鄉"],
    villages: {}
  },
  "台東縣": {
    townships: ["台東市", "成功鎮", "關山鎮", "卑南鄉", "鹿野鄉", "池上鄉", "東河鄉", "長濱鄉", "太麻里鄉", "大武鄉", "綠島鄉", "海端鄉", "延平鄉", "金峰鄉", "達仁鄉", "蘭嶼鄉"],
    villages: {}
  },
  "澎湖縣": {
    townships: ["馬公市", "湖西鄉", "白沙鄉", "西嶼鄉", "望安鄉", "七美鄉"],
    villages: {}
  },
  "金門縣": {
    townships: ["金城鎮", "金湖鎮", "金沙鎮", "金寧鄉", "烈嶼鄉", "烏坵鄉"],
    villages: {}
  },
  "連江縣": {
    townships: ["南竿鄉", "北竿鄉", "莒光鄉", "東引鄉"],
    villages: {}
  }
};

// 更新鄉鎮市區選單
function updateTownships() {
  const citySelect = document.getElementById('filterCity');
  const townshipSelect = document.getElementById('filterTownship');
  const villageSelect = document.getElementById('filterVillage');
  
  if (!citySelect || !townshipSelect || !villageSelect) {
    console.error('找不到篩選器元素');
    return;
  }
  
  const selectedCity = citySelect.value;
  
  // 清空鄉鎮和村里選單
  townshipSelect.innerHTML = '<option value="">所有鄉鎮市區</option>';
  villageSelect.innerHTML = '<option value="">所有村/里</option>';
  
  if (selectedCity && taiwanDistricts[selectedCity]) {
    const townships = taiwanDistricts[selectedCity].townships;
    if (townships && townships.length > 0) {
      townships.forEach(township => {
        const option = document.createElement('option');
        option.value = township;
        option.textContent = township;
        townshipSelect.appendChild(option);
      });
    }
  }
  
  // 觸發篩選
  if (typeof filterApplications === 'function') {
    filterApplications();
  }
  
  // 如果在地圖檢視，更新地圖標記
  if (typeof updateMapMarkers === 'function') {
    const mapView = document.getElementById('mapView');
    if (mapView && mapView.style.display !== 'none') {
      updateMapMarkers();
    }
  }
}

// 更新村里選單
function updateVillages() {
  const citySelect = document.getElementById('filterCity');
  const townshipSelect = document.getElementById('filterTownship');
  const villageSelect = document.getElementById('filterVillage');
  
  if (!citySelect || !townshipSelect || !villageSelect) {
    console.error('找不到篩選器元素');
    return;
  }
  
  const selectedCity = citySelect.value;
  const selectedTownship = townshipSelect.value;
  
  // 清空村里選單
  villageSelect.innerHTML = '<option value="">所有村/里</option>';
  
  if (selectedCity && selectedTownship && 
      taiwanDistricts[selectedCity] && 
      taiwanDistricts[selectedCity].villages[selectedTownship]) {
    const villages = taiwanDistricts[selectedCity].villages[selectedTownship];
    if (villages && villages.length > 0) {
      villages.forEach(village => {
        const option = document.createElement('option');
        option.value = village;
        option.textContent = village;
        villageSelect.appendChild(option);
      });
    }
  }
  
  // 觸發篩選
  if (typeof filterApplications === 'function') {
    filterApplications();
  }
  
  // 如果在地圖檢視，更新地圖標記
  if (typeof updateMapMarkers === 'function') {
    const mapView = document.getElementById('mapView');
    if (mapView && mapView.style.display !== 'none') {
      updateMapMarkers();
    }
  }
}
