<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç½æ°‘è£œåŠ©ç”³è«‹ç³»çµ± - API æ¸¬è©¦é é¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-right: 10px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .response {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .response.success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }

        .response.error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }

        .loading {
            display: none;
            text-align: center;
            color: #667eea;
            margin: 20px 0;
        }

        .loading.active {
            display: block;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        .status-online {
            background: #d4edda;
            color: #155724;
        }

        .status-offline {
            background: #f8d7da;
            color: #721c24;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .api-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .api-info a {
            color: white;
            text-decoration: underline;
        }

        code {
            background: rgba(0, 0, 0, 0.1);
            padding: 2px 6px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒŠ ç½æ°‘è£œåŠ©ç”³è«‹ç³»çµ± - API æ¸¬è©¦</h1>

        <div class="api-info">
            <h3>ğŸ“¡ API è³‡è¨Š</h3>
            <p><strong>Base URL:</strong> <code id="apiBaseUrl">http://localhost:8000/api/v1</code></p>
            <p><strong>æ–‡ä»¶:</strong> <a href="http://localhost:8000/docs" target="_blank">Swagger UI</a> | <a href="http://localhost:8000/redoc" target="_blank">ReDoc</a></p>
            <p><strong>ç‹€æ…‹:</strong> <span class="status-badge" id="apiStatus">æª¢æŸ¥ä¸­...</span></p>
        </div>

        <div class="grid">
            <!-- å»ºç«‹ä½¿ç”¨è€… -->
            <div class="card">
                <h2>1ï¸âƒ£ å»ºç«‹ä½¿ç”¨è€…</h2>
                <div class="form-group">
                    <label>Emailï¼š</label>
                    <input type="email" id="userEmail" value="test@example.com" placeholder="test@example.com">
                </div>
                <div class="form-group">
                    <label>å§“åï¼š</label>
                    <input type="text" id="userFullName" value="ç‹å°æ˜" placeholder="ç‹å°æ˜">
                </div>
                <div class="form-group">
                    <label>èº«åˆ†è­‰å­—è™Ÿï¼š</label>
                    <input type="text" id="userIdNumber" value="A123456789" placeholder="A123456789">
                </div>
                <div class="form-group">
                    <label>é›»è©±ï¼š</label>
                    <input type="tel" id="userPhone" value="0912345678" placeholder="0912345678">
                </div>
                <div class="form-group">
                    <label>è§’è‰²ï¼š</label>
                    <select id="userRole">
                        <option value="applicant">ç½æ°‘</option>
                        <option value="reviewer">å¯©æ ¸å“¡</option>
                        <option value="admin">ç®¡ç†å“¡</option>
                    </select>
                </div>
                <button onclick="createUser()">å»ºç«‹ä½¿ç”¨è€…</button>
                <div class="response" id="userResponse"></div>
            </div>

            <!-- å»ºç«‹ç”³è«‹ -->
            <div class="card">
                <h2>2ï¸âƒ£ å»ºç«‹ç”³è«‹æ¡ˆä»¶</h2>
                <div class="form-group">
                    <label>ç”³è«‹äºº IDï¼š</label>
                    <input type="text" id="applicantId" placeholder="å¾æ­¥é©Ÿ1è¤‡è£½ä½¿ç”¨è€…ID">
                </div>
                <div class="form-group">
                    <label>ç½å®³é¡å‹ï¼š</label>
                    <select id="disasterType">
                        <option value="typhoon">é¢±é¢¨</option>
                        <option value="flood">æ°´ç½</option>
                        <option value="earthquake">åœ°éœ‡</option>
                        <option value="fire">ç«ç½</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ç½ææè¿°ï¼š</label>
                    <textarea id="damageDescription" placeholder="è«‹æè¿°ç½ææƒ…å½¢...">é¢±é¢¨é€ æˆä¸€æ¨“å®¢å»³æ·¹æ°´ç´„50å…¬åˆ†ï¼Œå®¶å…·é›»å™¨æ³¡æ°´æå£</textarea>
                </div>
                <div class="form-group">
                    <label>ç”³è«‹é‡‘é¡ï¼š</label>
                    <input type="number" id="requestedAmount" value="50000" placeholder="50000">
                </div>
                <button onclick="createApplication()">å»ºç«‹ç”³è«‹</button>
                <div class="response" id="applicationResponse"></div>
            </div>
        </div>

        <!-- ä¸Šå‚³ç…§ç‰‡ -->
        <div class="card">
            <h2>3ï¸âƒ£ ä¸Šå‚³ç½æç…§ç‰‡</h2>
            <div class="form-group">
                <label>æ¡ˆä»¶ IDï¼š</label>
                <input type="text" id="photoApplicationId" placeholder="å¾æ­¥é©Ÿ2è¤‡è£½æ¡ˆä»¶ID">
            </div>
            <div class="form-group">
                <label>ä¸Šå‚³è€… IDï¼š</label>
                <input type="text" id="uploaderId" placeholder="å¾æ­¥é©Ÿ1è¤‡è£½ä½¿ç”¨è€…ID">
            </div>
            <div class="form-group">
                <label>ç…§ç‰‡é¡å‹ï¼š</label>
                <select id="photoType">
                    <option value="before_damage">ç½å‰ç…§ç‰‡</option>
                    <option value="after_damage">ç½å¾Œç…§ç‰‡</option>
                    <option value="inspection">ç¾å ´å‹˜æŸ¥</option>
                </select>
            </div>
            <div class="form-group">
                <label>ç…§ç‰‡èªªæ˜ï¼š</label>
                <input type="text" id="photoDescription" placeholder="ä¸€æ¨“å®¢å»³æ·¹æ°´æƒ…å½¢">
            </div>
            <div class="form-group">
                <label>é¸æ“‡ç…§ç‰‡ï¼š</label>
                <input type="file" id="photoFile" accept="image/*">
            </div>
            <button onclick="uploadPhoto()">ä¸Šå‚³ç…§ç‰‡</button>
            <div class="response" id="photoResponse"></div>
        </div>

        <!-- æŸ¥è©¢åŠŸèƒ½ -->
        <div class="grid">
            <div class="card">
                <h2>4ï¸âƒ£ æŸ¥è©¢æ¡ˆä»¶</h2>
                <div class="form-group">
                    <label>æ¡ˆä»¶ IDï¼š</label>
                    <input type="text" id="queryApplicationId" placeholder="è¼¸å…¥æ¡ˆä»¶ID">
                </div>
                <button onclick="getApplication()">æŸ¥è©¢æ¡ˆä»¶</button>
                <div class="response" id="queryResponse"></div>
            </div>

            <div class="card">
                <h2>5ï¸âƒ£ ç³»çµ±çµ±è¨ˆ</h2>
                <button onclick="getStats()">å–å¾—çµ±è¨ˆè³‡æ–™</button>
                <div class="response" id="statsResponse"></div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8000/api/v1';

        // æª¢æŸ¥ API ç‹€æ…‹
        async function checkApiStatus() {
            try {
                const response = await fetch('http://localhost:8000/health');
                const data = await response.json();
                
                const statusBadge = document.getElementById('apiStatus');
                if (response.ok) {
                    statusBadge.className = 'status-badge status-online';
                    statusBadge.textContent = 'ğŸŸ¢ ç·šä¸Š';
                } else {
                    statusBadge.className = 'status-badge status-offline';
                    statusBadge.textContent = 'ğŸ”´ é›¢ç·š';
                }
            } catch (error) {
                const statusBadge = document.getElementById('apiStatus');
                statusBadge.className = 'status-badge status-offline';
                statusBadge.textContent = 'ğŸ”´ é›¢ç·š';
            }
        }

        // å»ºç«‹ä½¿ç”¨è€…
        async function createUser() {
            const userData = {
                email: document.getElementById('userEmail').value,
                full_name: document.getElementById('userFullName').value,
                id_number: document.getElementById('userIdNumber').value,
                phone: document.getElementById('userPhone').value,
                role: document.getElementById('userRole').value
            };

            try {
                const response = await fetch(`${API_BASE_URL}/users/`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(userData)
                });

                const data = await response.json();
                const responseDiv = document.getElementById('userResponse');
                
                if (response.ok) {
                    responseDiv.className = 'response success';
                    responseDiv.textContent = `âœ… ä½¿ç”¨è€…å»ºç«‹æˆåŠŸï¼\n\nä½¿ç”¨è€… ID: ${data.data.id}\n\nå®Œæ•´è³‡æ–™ï¼š\n${JSON.stringify(data, null, 2)}`;
                    
                    // è‡ªå‹•å¡«å…¥ç”³è«‹äººID
                    document.getElementById('applicantId').value = data.data.id;
                    document.getElementById('uploaderId').value = data.data.id;
                } else {
                    responseDiv.className = 'response error';
                    responseDiv.textContent = `âŒ å»ºç«‹å¤±æ•—ï¼š\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                const responseDiv = document.getElementById('userResponse');
                responseDiv.className = 'response error';
                responseDiv.textContent = `âŒ éŒ¯èª¤ï¼š${error.message}`;
            }
        }

        // å»ºç«‹ç”³è«‹
        async function createApplication() {
            const applicantId = document.getElementById('applicantId').value;
            if (!applicantId) {
                alert('è«‹å…ˆå»ºç«‹ä½¿ç”¨è€…ä¸¦è¤‡è£½ä½¿ç”¨è€…ID');
                return;
            }

            const applicationData = {
                applicant_id: applicantId,
                applicant_name: document.getElementById('userFullName').value,
                id_number: document.getElementById('userIdNumber').value,
                phone: document.getElementById('userPhone').value,
                address: 'å°å—å¸‚ä¸­è¥¿å€æ°‘æ¬Šè·¯100è™Ÿ',
                disaster_date: new Date().toISOString().split('T')[0],
                disaster_type: document.getElementById('disasterType').value,
                damage_description: document.getElementById('damageDescription').value,
                damage_location: 'å°å—å¸‚ä¸­è¥¿å€æ°‘æ¬Šè·¯100è™Ÿ1æ¨“',
                subsidy_type: 'housing',
                requested_amount: parseFloat(document.getElementById('requestedAmount').value)
            };

            try {
                const response = await fetch(`${API_BASE_URL}/applications/`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(applicationData)
                });

                const data = await response.json();
                const responseDiv = document.getElementById('applicationResponse');
                
                if (response.ok) {
                    responseDiv.className = 'response success';
                    responseDiv.textContent = `âœ… ç”³è«‹å»ºç«‹æˆåŠŸï¼\n\næ¡ˆä»¶ç·¨è™Ÿ: ${data.data.case_no}\næ¡ˆä»¶ ID: ${data.data.id}\n\nå®Œæ•´è³‡æ–™ï¼š\n${JSON.stringify(data, null, 2)}`;
                    
                    // è‡ªå‹•å¡«å…¥æ¡ˆä»¶ID
                    document.getElementById('photoApplicationId').value = data.data.id;
                    document.getElementById('queryApplicationId').value = data.data.id;
                } else {
                    responseDiv.className = 'response error';
                    responseDiv.textContent = `âŒ å»ºç«‹å¤±æ•—ï¼š\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                const responseDiv = document.getElementById('applicationResponse');
                responseDiv.className = 'response error';
                responseDiv.textContent = `âŒ éŒ¯èª¤ï¼š${error.message}`;
            }
        }

        // ä¸Šå‚³ç…§ç‰‡
        async function uploadPhoto() {
            const applicationId = document.getElementById('photoApplicationId').value;
            const uploaderId = document.getElementById('uploaderId').value;
            const photoFile = document.getElementById('photoFile').files[0];

            if (!applicationId || !uploaderId) {
                alert('è«‹å…ˆå»ºç«‹ç”³è«‹æ¡ˆä»¶');
                return;
            }

            if (!photoFile) {
                alert('è«‹é¸æ“‡ç…§ç‰‡');
                return;
            }

            const formData = new FormData();
            formData.append('application_id', applicationId);
            formData.append('photo_type', document.getElementById('photoType').value);
            formData.append('description', document.getElementById('photoDescription').value);
            formData.append('uploaded_by', uploaderId);
            formData.append('file', photoFile);

            try {
                const response = await fetch(`${API_BASE_URL}/photos/upload`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                const responseDiv = document.getElementById('photoResponse');
                
                if (response.ok) {
                    responseDiv.className = 'response success';
                    responseDiv.textContent = `âœ… ç…§ç‰‡ä¸Šå‚³æˆåŠŸï¼\n\nç…§ç‰‡ ID: ${data.data.id}\nç…§ç‰‡ URL: ${data.data.photo_url}\n\nå®Œæ•´è³‡æ–™ï¼š\n${JSON.stringify(data, null, 2)}`;
                } else {
                    responseDiv.className = 'response error';
                    responseDiv.textContent = `âŒ ä¸Šå‚³å¤±æ•—ï¼š\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                const responseDiv = document.getElementById('photoResponse');
                responseDiv.className = 'response error';
                responseDiv.textContent = `âŒ éŒ¯èª¤ï¼š${error.message}`;
            }
        }

        // æŸ¥è©¢æ¡ˆä»¶
        async function getApplication() {
            const applicationId = document.getElementById('queryApplicationId').value;
            if (!applicationId) {
                alert('è«‹è¼¸å…¥æ¡ˆä»¶ID');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/applications/${applicationId}`);
                const data = await response.json();
                const responseDiv = document.getElementById('queryResponse');
                
                if (response.ok) {
                    responseDiv.className = 'response success';
                    responseDiv.textContent = `âœ… æŸ¥è©¢æˆåŠŸï¼\n\n${JSON.stringify(data, null, 2)}`;
                } else {
                    responseDiv.className = 'response error';
                    responseDiv.textContent = `âŒ æŸ¥è©¢å¤±æ•—ï¼š\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                const responseDiv = document.getElementById('queryResponse');
                responseDiv.className = 'response error';
                responseDiv.textContent = `âŒ éŒ¯èª¤ï¼š${error.message}`;
            }
        }

        // å–å¾—çµ±è¨ˆè³‡æ–™
        async function getStats() {
            try {
                const response = await fetch(`${API_BASE_URL}/stats`);
                const data = await response.json();
                const responseDiv = document.getElementById('statsResponse');
                
                if (response.ok) {
                    responseDiv.className = 'response success';
                    const stats = data.data;
                    responseDiv.textContent = `âœ… çµ±è¨ˆè³‡æ–™ï¼š\n\n` +
                        `ç¸½ç”³è«‹æ¡ˆä»¶: ${stats.total_applications}\n` +
                        `å¾…å¯©æ ¸: ${stats.pending_applications}\n` +
                        `å¯©æ ¸ä¸­: ${stats.under_review_applications}\n` +
                        `å·²æ ¸å‡†: ${stats.approved_applications}\n` +
                        `å·²é§å›: ${stats.rejected_applications}\n` +
                        `å·²å®Œæˆ: ${stats.completed_applications}\n` +
                        `ç¸½æ ¸å‡†é‡‘é¡: ${stats.total_approved_amount}\n` +
                        `å·²ç™¼æ”¾é‡‘é¡: ${stats.total_disbursed_amount}\n\n` +
                        `å®Œæ•´è³‡æ–™ï¼š\n${JSON.stringify(data, null, 2)}`;
                } else {
                    responseDiv.className = 'response error';
                    responseDiv.textContent = `âŒ æŸ¥è©¢å¤±æ•—ï¼š\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                const responseDiv = document.getElementById('statsResponse');
                responseDiv.className = 'response error';
                responseDiv.textContent = `âŒ éŒ¯èª¤ï¼š${error.message}`;
            }
        }

        // é é¢è¼‰å…¥æ™‚æª¢æŸ¥ API ç‹€æ…‹
        checkApiStatus();
        setInterval(checkApiStatus, 10000); // æ¯ 10 ç§’æª¢æŸ¥ä¸€æ¬¡
    </script>
</body>
</html>

