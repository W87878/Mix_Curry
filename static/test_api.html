<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç½æ°‘è£œåŠ©ç”³è«‹ç³»çµ± V2.0</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            background: white;
            padding: 16px 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 20px;
            font-weight: 500;
            color: #5f6368;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 14px;
            color: #5f6368;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #34a853;
        }

        .status-dot.offline {
            background: #ea4335;
        }

        .logout-btn {
            padding: 8px 16px;
            background: transparent;
            border: 1px solid #dadce0;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            color: #5f6368;
            transition: all 0.2s;
        }

        .logout-btn:hover {
            background: #f8f9fa;
            border-color: #5f6368;
        }

        /* Main Content */
        .container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 60px 24px;
            max-width: 600px;
            margin: 0 auto;
            width: 100%;
        }

        .main-title {
            font-size: 48px;
            font-weight: 300;
            color: #202124;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }

        .subtitle {
            font-size: 16px;
            color: #5f6368;
            margin-bottom: 40px;
        }

        /* Card */
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
            padding: 40px;
            width: 100%;
            margin-bottom: 24px;
        }

        .card-title {
            font-size: 24px;
            font-weight: 400;
            color: #202124;
            margin-bottom: 24px;
        }

        /* Form */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-size: 14px;
            color: #5f6368;
            margin-bottom: 8px;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #dadce0;
            border-radius: 4px;
            font-size: 16px;
            color: #202124;
            transition: all 0.2s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #1a73e8;
            box-shadow: 0 0 0 1px #1a73e8;
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #1a73e8;
            color: white;
        }

        .btn-primary:hover {
            background: #1557b0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        .btn-secondary {
            background: transparent;
            color: #1a73e8;
            border: 1px solid #dadce0;
        }

        .btn-secondary:hover {
            background: #f8f9fa;
        }

        .btn-success {
            background: #34a853;
            color: white;
        }

        .btn-success:hover {
            background: #2d8e47;
        }

        .btn-danger {
            background: #ea4335;
            color: white;
        }

        .btn-danger:hover {
            background: #d33b2c;
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        /* Navigation Pills */
        .nav-pills {
            display: flex;
            gap: 8px;
            margin-bottom: 32px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-pill {
            padding: 8px 16px;
            border-radius: 20px;
            border: none;
            background: transparent;
            color: #5f6368;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .nav-pill:hover {
            background: #f1f3f4;
        }

        .nav-pill.active {
            background: #e8f0fe;
            color: #1a73e8;
        }

        /* Response */
        .response {
            margin-top: 24px;
            padding: 16px;
            border-radius: 4px;
            background: #f8f9fa;
            border-left: 4px solid #5f6368;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }

        .response.success {
            background: #e6f4ea;
            border-left-color: #34a853;
            color: #1e8e3e;
        }

        .response.error {
            background: #fce8e6;
            border-left-color: #ea4335;
            color: #c5221f;
        }

        .token-info {
            margin-top: 16px;
            padding: 12px;
            background: #e8f0fe;
            border-radius: 4px;
            font-size: 12px;
            color: #1967d2;
            word-break: break-all;
            display: none;
        }

        /* Hide/Show */
        .hidden {
            display: none;
        }

        /* Loading */
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #1a73e8;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Helper text */
        .helper-text {
            font-size: 12px;
            color: #5f6368;
            margin-top: 4px;
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            width: 100%;
            margin-bottom: 32px;
        }

        .quick-action {
            background: white;
            border: 1px solid #dadce0;
            border-radius: 8px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-action:hover {
            border-color: #1a73e8;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12);
        }

        .quick-action-icon {
            font-size: 32px;
            margin-bottom: 12px;
        }

        .quick-action-title {
            font-size: 16px;
            font-weight: 500;
            color: #202124;
            margin-bottom: 4px;
        }

        .quick-action-desc {
            font-size: 13px;
            color: #5f6368;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">ğŸŒŠ ç½æ°‘è£œåŠ©ç”³è«‹ç³»çµ± V2.0</div>
        <div class="user-info">
            <div class="status-dot" id="statusDot"></div>
            <span id="userName">æœªç™»å…¥</span>
            <button class="logout-btn hidden" id="logoutBtn" onclick="logout()">ç™»å‡º</button>
        </div>
    </div>

    <div class="container">
        <!-- Welcome Screen -->
        <div id="welcomeScreen">
            <h1 class="main-title">æ­¡è¿ä½¿ç”¨</h1>
            <p class="subtitle">é¸æ“‡æ‚¨è¦é€²è¡Œçš„æ“ä½œ</p>

            <div class="quick-actions">
                <div class="quick-action" onclick="showScreen('loginScreen')">
                    <div class="quick-action-icon">ğŸ”</div>
                    <div class="quick-action-title">ç™»å…¥</div>
                    <div class="quick-action-desc">å·²æœ‰å¸³è™Ÿï¼Œç«‹å³ç™»å…¥</div>
                </div>

                <div class="quick-action" onclick="showScreen('registerScreen')">
                    <div class="quick-action-icon">ğŸ“</div>
                    <div class="quick-action-title">è¨»å†Š</div>
                    <div class="quick-action-desc">å»ºç«‹æ–°çš„ä½¿ç”¨è€…å¸³è™Ÿ</div>
                </div>

                <div class="quick-action" onclick="showScreen('menuScreen')">
                    <div class="quick-action-icon">ğŸ¯</div>
                    <div class="quick-action-title">åŠŸèƒ½é¸å–®</div>
                    <div class="quick-action-desc">æŸ¥çœ‹æ‰€æœ‰åŠŸèƒ½</div>
                </div>
            </div>
        </div>

        <!-- Login Screen -->
        <div id="loginScreen" class="hidden">
            <div class="card">
                <h2 class="card-title">ç™»å…¥å¸³è™Ÿ</h2>
                
                <div class="form-group">
                    <label>Email å¸³è™Ÿ</label>
                    <input type="email" id="loginEmail" placeholder="user@example.com">
                </div>

                <div class="form-group">
                    <label>å¯†ç¢¼</label>
                    <input type="password" id="loginPassword" placeholder="ç•™ç©ºå³å¯ï¼ˆé–‹ç™¼æ¨¡å¼ï¼‰">
                    <div class="helper-text">ğŸ’¡ é–‹ç™¼æ¨¡å¼ä¸‹å¯ä»¥ä¸è¼¸å…¥å¯†ç¢¼</div>
                </div>

                <div class="button-group">
                    <button class="btn btn-secondary" onclick="showScreen('welcomeScreen')">è¿”å›</button>
                    <button class="btn btn-primary" onclick="login()">ç™»å…¥</button>
                </div>

                <div id="loginResponse" class="response"></div>
                <div id="loginToken" class="token-info"></div>
            </div>
        </div>

        <!-- Register Screen -->
        <div id="registerScreen" class="hidden">
            <div class="card">
                <h2 class="card-title">è¨»å†Šæ–°å¸³è™Ÿ</h2>

                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="regEmail" placeholder="user@example.com">
                </div>

                <div class="form-group">
                    <label>å§“å</label>
                    <input type="text" id="regName" placeholder="ç‹å°æ˜">
                </div>

                <div class="form-group">
                    <label>èº«åˆ†è­‰å­—è™Ÿ</label>
                    <input type="text" id="regIdNumber" placeholder="A123456789">
                </div>

                <div class="form-group">
                    <label>æ‰‹æ©Ÿè™Ÿç¢¼</label>
                    <input type="tel" id="regPhone" placeholder="0912345678">
                </div>

                <div class="form-group">
                    <label>è§’è‰²</label>
                    <select id="regRole" onchange="toggleDistrictField()">
                        <option value="applicant">ç½æ°‘</option>
                        <option value="reviewer">é‡Œé•·</option>
                        <option value="admin">ç®¡ç†å“¡</option>
                    </select>
                </div>

                <div class="form-group hidden" id="districtField">
                    <label>æ‰€å±¬å€åŸŸ</label>
                    <select id="regDistrict"></select>
                    <div class="helper-text">é‡Œé•·å¸³è™Ÿå¿…é ˆé¸æ“‡æ‰€å±¬å€åŸŸ</div>
                </div>

                <div class="button-group">
                    <button class="btn btn-secondary" onclick="showScreen('welcomeScreen')">è¿”å›</button>
                    <button class="btn btn-primary" onclick="register()">è¨»å†Š</button>
                </div>

                <div id="registerResponse" class="response"></div>
            </div>
        </div>

        <!-- Menu Screen -->
        <div id="menuScreen" class="hidden">
            <h2 class="card-title" style="text-align: center; margin-bottom: 32px;">åŠŸèƒ½é¸å–®</h2>

            <div class="quick-actions">
                <div class="quick-action" onclick="showScreen('applyScreen')">
                    <div class="quick-action-icon">ğŸ“‹</div>
                    <div class="quick-action-title">æäº¤ç”³è«‹</div>
                    <div class="quick-action-desc">ç½æ°‘å¡«å¯«è£œåŠ©ç”³è«‹</div>
                </div>

                <div class="quick-action" onclick="showScreen('reviewScreen')">
                    <div class="quick-action-icon">âœ…</div>
                    <div class="quick-action-title">å¯©æ ¸æ¡ˆä»¶</div>
                    <div class="quick-action-desc">é‡Œé•·å¯©æ ¸ç”³è«‹æ¡ˆä»¶</div>
                </div>

                <div class="quick-action" onclick="showScreen('queryScreen')">
                    <div class="quick-action-icon">ğŸ”</div>
                    <div class="quick-action-title">æŸ¥è©¢æ¡ˆä»¶</div>
                    <div class="quick-action-desc">æŸ¥çœ‹ç”³è«‹ç‹€æ…‹</div>
                </div>

                <div class="quick-action" onclick="showScreen('notificationScreen')">
                    <div class="quick-action-icon">ğŸ””</div>
                    <div class="quick-action-title">é€šçŸ¥ä¸­å¿ƒ</div>
                    <div class="quick-action-desc">æŸ¥çœ‹ç³»çµ±é€šçŸ¥</div>
                </div>

                <div class="quick-action" onclick="showScreen('districtScreen')">
                    <div class="quick-action-icon">ğŸ˜ï¸</div>
                    <div class="quick-action-title">å€åŸŸç®¡ç†</div>
                    <div class="quick-action-desc">æŸ¥çœ‹å€åŸŸè³‡è¨Š</div>
                </div>

                <div class="quick-action" onclick="showScreen('certificateScreen')">
                    <div class="quick-action-icon">ğŸ“±</div>
                    <div class="quick-action-title">æ•¸ä½æ†‘è­‰</div>
                    <div class="quick-action-desc">æ†‘è­‰æŸ¥è©¢èˆ‡ç®¡ç†</div>
                </div>
            </div>

            <div style="text-align: center;">
                <button class="btn btn-secondary" onclick="showScreen('welcomeScreen')">è¿”å›é¦–é </button>
            </div>
        </div>

        <!-- Apply Screen -->
        <div id="applyScreen" class="hidden">
            <div class="card">
                <h2 class="card-title">æäº¤è£œåŠ©ç”³è«‹</h2>

                <div class="form-group">
                    <label>å§“å</label>
                    <input type="text" id="appName" placeholder="ç‹å°æ˜">
                </div>

                <div class="form-group">
                    <label>èº«åˆ†è­‰å­—è™Ÿ</label>
                    <input type="text" id="appIdNumber" placeholder="A123456789">
                </div>

                <div class="form-group">
                    <label>æ‰‹æ©Ÿè™Ÿç¢¼</label>
                    <input type="tel" id="appPhone" placeholder="0912345678">
                </div>

                <div class="form-group">
                    <label>åœ°å€</label>
                    <input type="text" id="appAddress" placeholder="å°å—å¸‚ä¸­è¥¿å€æ°‘æ¬Šè·¯100è™Ÿ">
                </div>

                <div class="form-group">
                    <label>ç½å®³æ—¥æœŸ</label>
                    <input type="date" id="appDate">
                </div>

                <div class="form-group">
                    <label>ç½å®³é¡å‹</label>
                    <select id="appType">
                        <option value="flood">æ°´ç½</option>
                        <option value="typhoon">é¢±é¢¨</option>
                        <option value="earthquake">åœ°éœ‡</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>ç½ææè¿°</label>
                    <textarea id="appDesc" rows="3" placeholder="è«‹è©³ç´°æè¿°ç½ææƒ…æ³..."></textarea>
                </div>

                <div class="form-group">
                    <label>ç”³è«‹é‡‘é¡</label>
                    <input type="number" id="appAmount" placeholder="50000">
                </div>

                <div class="button-group">
                    <button class="btn btn-secondary" onclick="showScreen('menuScreen')">è¿”å›</button>
                    <button class="btn btn-primary" onclick="submitApplication()">æäº¤ç”³è«‹</button>
                </div>

                <div id="applyResponse" class="response"></div>
            </div>
        </div>

        <!-- Review Screen -->
        <div id="reviewScreen" class="hidden">
            <div class="card">
                <h2 class="card-title">å¯©æ ¸ç”³è«‹æ¡ˆä»¶</h2>

                <div style="text-align: center; margin-bottom: 24px;">
                    <button class="btn btn-primary" onclick="loadPendingApplications()">è¼‰å…¥å¾…å¯©æ ¸æ¡ˆä»¶</button>
                </div>

                <div id="pendingList"></div>

                <div id="reviewForm" class="hidden">
                    <hr style="margin: 24px 0; border: none; border-top: 1px solid #dadce0;">

                    <div class="form-group">
                        <label>æ¡ˆä»¶ ID</label>
                        <input type="text" id="reviewAppId" readonly>
                    </div>

                    <div class="form-group">
                        <label>å¯©æ ¸æ„è¦‹</label>
                        <textarea id="reviewComments" rows="2" placeholder="å¯©æ ¸æ„è¦‹..."></textarea>
                    </div>

                    <div class="form-group">
                        <label>æ ¸å‡†é‡‘é¡</label>
                        <input type="number" id="reviewAmount" placeholder="50000">
                    </div>

                    <div class="button-group">
                        <button class="btn btn-danger" onclick="rejectApp()">âŒ é§å›</button>
                        <button class="btn btn-success" onclick="approveApp()">âœ… æ ¸å‡†</button>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn btn-secondary" onclick="showScreen('menuScreen')">è¿”å›é¸å–®</button>
                </div>

                <div id="reviewResponse" class="response"></div>
            </div>
        </div>

        <!-- Query Screen -->
        <div id="queryScreen" class="hidden">
            <div class="card">
                <h2 class="card-title">æŸ¥è©¢æˆ‘çš„ç”³è«‹</h2>

                <div style="text-align: center;">
                    <button class="btn btn-primary" onclick="getMyApplications()">æŸ¥è©¢</button>
                </div>

                <div class="button-group">
                    <button class="btn btn-secondary" onclick="showScreen('menuScreen')">è¿”å›</button>
                </div>

                <div id="queryResponse" class="response"></div>
            </div>
        </div>

        <!-- Notification Screen -->
        <div id="notificationScreen" class="hidden">
            <div class="card">
                <h2 class="card-title">é€šçŸ¥ä¸­å¿ƒ</h2>

                <div class="button-group">
                    <button class="btn btn-primary" onclick="getNotifications()">æ‰€æœ‰é€šçŸ¥</button>
                    <button class="btn btn-secondary" onclick="getUnreadCount()">æœªè®€æ•¸é‡</button>
                </div>

                <div class="button-group">
                    <button class="btn btn-secondary" onclick="showScreen('menuScreen')">è¿”å›</button>
                </div>

                <div id="notifResponse" class="response"></div>
            </div>
        </div>

        <!-- District Screen -->
        <div id="districtScreen" class="hidden">
            <div class="card">
                <h2 class="card-title">å€åŸŸç®¡ç†</h2>

                <div style="text-align: center;">
                    <button class="btn btn-primary" onclick="getDistricts()">æŸ¥çœ‹æ‰€æœ‰å€åŸŸ</button>
                </div>

                <div class="button-group">
                    <button class="btn btn-secondary" onclick="showScreen('menuScreen')">è¿”å›</button>
                </div>

                <div id="districtResponse" class="response"></div>
            </div>
        </div>

        <!-- Certificate Screen -->
        <div id="certificateScreen" class="hidden">
            <div class="card">
                <h2 class="card-title">æ•¸ä½æ†‘è­‰</h2>

                <div class="form-group">
                    <label>æ†‘è­‰ç·¨è™Ÿ</label>
                    <input type="text" id="certNo" placeholder="CERT-2025-00001">
                </div>

                <div class="button-group">
                    <button class="btn btn-secondary" onclick="showScreen('menuScreen')">è¿”å›</button>
                    <button class="btn btn-primary" onclick="getCertificate()">æŸ¥è©¢æ†‘è­‰</button>
                </div>

                <div id="certResponse" class="response"></div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080/api/v1';
        let accessToken = localStorage.getItem('access_token');
        let currentUser = JSON.parse(localStorage.getItem('user') || 'null');

        // Initialize
        updateAuthStatus();
        loadDistrictsForSelect();

        function showScreen(screenId) {
            // Hide all screens
            document.querySelectorAll('.container > div').forEach(div => {
                div.classList.add('hidden');
            });
            // Show selected screen
            document.getElementById(screenId).classList.remove('hidden');
        }

        function updateAuthStatus() {
            const statusDot = document.getElementById('statusDot');
            const userName = document.getElementById('userName');
            const logoutBtn = document.getElementById('logoutBtn');

            if (accessToken && currentUser) {
                statusDot.classList.remove('offline');
                userName.textContent = `${currentUser.full_name} (${currentUser.role})`;
                logoutBtn.classList.remove('hidden');
            } else {
                statusDot.classList.add('offline');
                userName.textContent = 'æœªç™»å…¥';
                logoutBtn.classList.add('hidden');
            }
        }

        function showResponse(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `response ${isError ? 'error' : 'success'}`;
            element.textContent = JSON.stringify(data, null, 2);
        }

        async function apiCall(endpoint, method = 'GET', body = null, requireAuth = false) {
            const options = {
                method,
                headers: { 'Content-Type': 'application/json' }
            };

            if (requireAuth && accessToken) {
                options.headers['Authorization'] = `Bearer ${accessToken}`;
            }

            if (body) {
                options.body = JSON.stringify(body);
            }

            try {
                const response = await fetch(`${API_BASE}${endpoint}`, options);
                const data = await response.json();
                return { success: response.ok, data, status: response.status };
            } catch (error) {
                return { success: false, data: { error: error.message }, status: 0 };
            }
        }

        function toggleDistrictField() {
            const role = document.getElementById('regRole').value;
            const field = document.getElementById('districtField');
            field.classList.toggle('hidden', role !== 'reviewer');
        }

        async function loadDistrictsForSelect() {
            const result = await apiCall('/districts/', 'GET');
            if (result.success) {
                const select = document.getElementById('regDistrict');
                select.innerHTML = '';
                result.data.forEach(d => {
                    const option = document.createElement('option');
                    option.value = d.id;
                    option.textContent = d.district_name;
                    select.appendChild(option);
                });
            }
        }

        async function register() {
            const data = {
                email: document.getElementById('regEmail').value,
                full_name: document.getElementById('regName').value,
                id_number: document.getElementById('regIdNumber').value,
                phone: document.getElementById('regPhone').value,
                role: document.getElementById('regRole').value
            };

            if (data.role === 'reviewer') {
                data.district_id = document.getElementById('regDistrict').value;
            }

            const result = await apiCall('/auth/register', 'POST', data);
            showResponse('registerResponse', result.data, !result.success);
        }

        async function login() {
            const data = {
                email: document.getElementById('loginEmail').value,
                password: document.getElementById('loginPassword').value || '',
                login_type: 'password'
            };

            const result = await apiCall('/auth/login', 'POST', data);
            showResponse('loginResponse', result.data, !result.success);

            if (result.success) {
                accessToken = result.data.access_token;
                currentUser = result.data.user;
                localStorage.setItem('access_token', accessToken);
                localStorage.setItem('user', JSON.stringify(currentUser));
                updateAuthStatus();

                document.getElementById('loginToken').style.display = 'block';
                document.getElementById('loginToken').textContent = `âœ… ç™»å…¥æˆåŠŸï¼Token å·²å„²å­˜`;

                setTimeout(() => showScreen('menuScreen'), 1500);
            }
        }

        function logout() {
            accessToken = null;
            currentUser = null;
            localStorage.clear();
            updateAuthStatus();
            showScreen('welcomeScreen');
        }

        async function submitApplication() {
            if (!currentUser) {
                alert('è«‹å…ˆç™»å…¥ï¼');
                showScreen('loginScreen');
                return;
            }

            const data = {
                applicant_id: currentUser.id,
                applicant_name: document.getElementById('appName').value,
                id_number: document.getElementById('appIdNumber').value,
                phone: document.getElementById('appPhone').value,
                address: document.getElementById('appAddress').value,
                disaster_date: document.getElementById('appDate').value,
                disaster_type: document.getElementById('appType').value,
                damage_description: document.getElementById('appDesc').value,
                damage_location: document.getElementById('appAddress').value,
                subsidy_type: 'housing',
                requested_amount: parseFloat(document.getElementById('appAmount').value)
            };

            const result = await apiCall('/applications/', 'POST', data, true);
            showResponse('applyResponse', result.data, !result.success);
        }

        async function loadPendingApplications() {
            const result = await apiCall('/applications/status/pending', 'GET', null, true);
            if (result.success && result.data.length > 0) {
                const list = document.getElementById('pendingList');
                list.innerHTML = '<h3 style="margin-bottom: 16px;">å¾…å¯©æ ¸æ¡ˆä»¶</h3>';
                result.data.forEach(app => {
                    const item = document.createElement('div');
                    item.style.cssText = 'padding: 12px; margin-bottom: 8px; background: #f8f9fa; border-radius: 4px; cursor: pointer;';
                    item.innerHTML = `
                        <strong>${app.case_no}</strong> - ${app.applicant_name}<br>
                        <small style="color: #5f6368;">é‡‘é¡: $${app.requested_amount?.toLocaleString()}</small>
                    `;
                    item.onclick = () => selectApplicationForReview(app);
                    list.appendChild(item);
                });
            } else {
                showResponse('reviewResponse', { message: 'æ²’æœ‰å¾…å¯©æ ¸æ¡ˆä»¶' }, false);
            }
        }

        function selectApplicationForReview(app) {
            document.getElementById('reviewAppId').value = app.id;
            document.getElementById('reviewAmount').value = app.requested_amount;
            document.getElementById('reviewForm').classList.remove('hidden');
        }

        async function approveApp() {
            const appId = document.getElementById('reviewAppId').value;
            const data = {
                approved_amount: parseFloat(document.getElementById('reviewAmount').value),
                comments: document.getElementById('reviewComments').value
            };
            const result = await apiCall(`/reviews/approve/${appId}`, 'POST', data, true);
            showResponse('reviewResponse', result.data, !result.success);
        }

        async function rejectApp() {
            const appId = document.getElementById('reviewAppId').value;
            const data = {
                rejection_reason: document.getElementById('reviewComments').value,
                comments: document.getElementById('reviewComments').value
            };
            const result = await apiCall(`/reviews/reject/${appId}`, 'POST', data, true);
            showResponse('reviewResponse', result.data, !result.success);
        }

        async function getMyApplications() {
            if (!currentUser) {
                alert('è«‹å…ˆç™»å…¥ï¼');
                return;
            }
            const result = await apiCall(`/applications/applicant/${currentUser.id}`, 'GET', null, true);
            showResponse('queryResponse', result.data, !result.success);
        }

        async function getNotifications() {
            const result = await apiCall('/notifications/', 'GET', null, true);
            showResponse('notifResponse', result.data, !result.success);
        }

        async function getUnreadCount() {
            const result = await apiCall('/notifications/unread-count', 'GET', null, true);
            showResponse('notifResponse', result.data, !result.success);
        }

        async function getDistricts() {
            const result = await apiCall('/districts/', 'GET');
            showResponse('districtResponse', result.data, !result.success);
        }

        async function getCertificate() {
            const certNo = document.getElementById('certNo').value;
            const result = await apiCall(`/certificates/${certNo}`, 'GET', null, true);
            showResponse('certResponse', result.data, !result.success);
        }
    </script>
</body>
</html>
