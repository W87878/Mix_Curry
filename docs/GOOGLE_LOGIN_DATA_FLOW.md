# Google ç™»å…¥ â†’ ç”³è«‹è¡¨å–® è³‡æ–™æµç¨‹

## ğŸ“‹ å®Œæ•´æµç¨‹èªªæ˜

### 1. ä½¿ç”¨è€…é€é Google ç™»å…¥

```
ä½¿ç”¨è€…é»æ“Šã€ŒGoogle ç™»å…¥ã€
    â†“
å‰å¾€ Google æˆæ¬Šé é¢
    â†“
ä½¿ç”¨è€…åŒæ„æˆæ¬Š
    â†“
ç³»çµ±å»ºç«‹ä½¿ç”¨è€…å¸³è™Ÿ
```

**å»ºç«‹çš„ä½¿ç”¨è€…è³‡æ–™ï¼š**
```json
{
    "email": "user@gmail.com",        // å¾ Google å–å¾—
    "full_name": "ç‹å°æ˜",            // å¾ Google å–å¾—
    "id_number": "GOOGLE_1234567890", // âš ï¸ è‡¨æ™‚å€¼
    "phone": "",                      // âš ï¸ ç©ºå€¼
    "role": "applicant",
    "is_verified": false              // âš ï¸ å°šæœªå®Œå…¨é©—è­‰
}
```

### 2. ä½¿ç”¨è€…å¡«å¯«ç”³è«‹è¡¨å–®

ç™»å…¥å¾Œï¼Œä½¿ç”¨è€…å‰å¾€ç”³è«‹é é¢å¡«å¯«è¡¨å–®ï¼š

```
ç½æ°‘å‰å° (/applicant)
    â†“
å¡«å¯«ç”³è«‹è¡¨å–®
    â†“
è¼¸å…¥çœŸå¯¦è³‡æ–™ï¼š
  - èº«åˆ†è­‰å­—è™Ÿ: A123456789  âœ… çœŸå¯¦èº«åˆ†è­‰
  - æ‰‹æ©Ÿè™Ÿç¢¼: 0912345678     âœ… çœŸå¯¦æ‰‹æ©Ÿ
  - åœ°å€ã€ç½æè³‡æ–™ç­‰...
    â†“
æäº¤ç”³è«‹
```

### 3. ç³»çµ±è‡ªå‹•æ›´æ–°ä½¿ç”¨è€…è³‡æ–™

ç•¶ä½¿ç”¨è€…æäº¤ç”³è«‹æ™‚ï¼Œç³»çµ±æœƒæª¢æŸ¥ï¼š

```python
# åœ¨ app/routers/applications.py çš„ create_application()

if user.get("id_number", "").startswith("GOOGLE_"):
    # é€™æ˜¯ Google ç™»å…¥çš„ä½¿ç”¨è€…ï¼Œæ›´æ–°ç‚ºçœŸå¯¦è³‡æ–™
    update_data = {
        "id_number": "A123456789",  # å¾è¡¨å–®å–å¾—çš„çœŸå¯¦èº«åˆ†è­‰
        "phone": "0912345678",      # å¾è¡¨å–®å–å¾—çš„çœŸå¯¦æ‰‹æ©Ÿ
        "is_verified": True,        # æ¨™è¨˜ç‚ºå·²é©—è­‰
        "updated_at": datetime.now().isoformat()
    }
    db_service.client.table("users").update(update_data)
                     .eq("id", user_id).execute()
```

**æ›´æ–°å¾Œçš„ä½¿ç”¨è€…è³‡æ–™ï¼š**
```json
{
    "email": "user@gmail.com",
    "full_name": "ç‹å°æ˜",
    "id_number": "A123456789",    // âœ… å·²æ›´æ–°ç‚ºçœŸå¯¦èº«åˆ†è­‰
    "phone": "0912345678",        // âœ… å·²æ›´æ–°ç‚ºçœŸå¯¦æ‰‹æ©Ÿ
    "role": "applicant",
    "is_verified": true           // âœ… å·²å®Œå…¨é©—è­‰
}
```

### 4. ç”³è«‹æ¡ˆä»¶å»ºç«‹

åŒæ™‚å»ºç«‹ç”³è«‹æ¡ˆä»¶ï¼š

```json
{
    "applicant_id": "user-uuid",
    "applicant_name": "ç‹å°æ˜",
    "id_number": "A123456789",
    "phone": "0912345678",
    "address": "å°å—å¸‚ä¸­è¥¿å€æ°‘æ¬Šè·¯...",
    "disaster_type": "æ°´ç½",
    "damage_description": "...",
    // å…¶ä»–ç”³è«‹è³‡æ–™
}
```

## ğŸ”„ è³‡æ–™æµç¨‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     1. Google OAuth ç™»å…¥                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                    å»ºç«‹ users è¨˜éŒ„
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ id_number:      â”‚
                    â”‚ "GOOGLE_xxx"    â”‚ â† è‡¨æ™‚å€¼
                    â”‚ phone: ""       â”‚ â† ç©ºå€¼
                    â”‚ is_verified:    â”‚
                    â”‚ false           â”‚ â† æœªé©—è­‰
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    2. å¡«å¯«ç”³è«‹è¡¨å–®                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                    ä½¿ç”¨è€…è¼¸å…¥çœŸå¯¦è³‡æ–™
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ èº«åˆ†è­‰: A123... â”‚
                    â”‚ æ‰‹æ©Ÿ: 0912...   â”‚
                    â”‚ åœ°å€: å°å—å¸‚... â”‚
                    â”‚ ç½æè³‡æ–™...     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    3. æäº¤ç”³è«‹                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                    æª¢æŸ¥ id_number æ˜¯å¦ç‚º "GOOGLE_xxx"
                              â†“
                         æ˜¯ â†’ æ›´æ–° users è¡¨
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ id_number:      â”‚
                    â”‚ "A123456789"    â”‚ â† çœŸå¯¦èº«åˆ†è­‰ âœ…
                    â”‚ phone:          â”‚
                    â”‚ "0912345678"    â”‚ â† çœŸå¯¦æ‰‹æ©Ÿ âœ…
                    â”‚ is_verified:    â”‚
                    â”‚ true            â”‚ â† å·²é©—è­‰ âœ…
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                    å»ºç«‹ applications è¨˜éŒ„
                    ä½¿ç”¨çœŸå¯¦çš„èº«åˆ†è­‰å’Œæ‰‹æ©Ÿè³‡æ–™
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    4. ç”³è«‹æˆåŠŸ                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ é—œéµé»

### âœ… ç‚ºä»€éº¼ä¸åœ¨ç™»å…¥æ™‚è¦æ±‚å¡«å¯«èº«åˆ†è­‰ï¼Ÿ

1. **UX è€ƒé‡**ï¼šè®“ç™»å…¥æµç¨‹ç›¡å¯èƒ½ç°¡å–®å¿«é€Ÿ
2. **è‡ªç„¶æµç¨‹**ï¼šä½¿ç”¨è€…åœ¨ç”³è«‹æ™‚æ‰éœ€è¦æä¾›å®Œæ•´è³‡æ–™
3. **æ¸›å°‘æ‘©æ“¦**ï¼šä¸å¼·åˆ¶ä½¿ç”¨è€…åœ¨ç™»å…¥éšæ®µæä¾›æ•æ„Ÿè³‡æ–™

### âœ… å¦‚ä½•è­˜åˆ¥éœ€è¦æ›´æ–°çš„ä½¿ç”¨è€…ï¼Ÿ

ä½¿ç”¨ `id_number` æ¬„ä½çš„å‰ç¶´åˆ¤æ–·ï¼š
- ä»¥ `GOOGLE_` é–‹é ­ â†’ Google ç™»å…¥ä½¿ç”¨è€…ï¼Œéœ€è¦æ›´æ–°
- å…¶ä»–æ ¼å¼ â†’ å·²æœ‰çœŸå¯¦èº«åˆ†è­‰ï¼Œä¸éœ€è¦æ›´æ–°

### âœ… è³‡æ–™ä¸€è‡´æ€§ä¿è­‰

1. **Users è¡¨**ï¼šå„²å­˜ä½¿ç”¨è€…çš„åŸºæœ¬è³‡æ–™ï¼ˆemail, å§“å, èº«åˆ†è­‰, æ‰‹æ©Ÿï¼‰
2. **Applications è¡¨**ï¼šå„²å­˜æ¯æ¬¡ç”³è«‹çš„å®Œæ•´è³‡æ–™
3. æäº¤ç”³è«‹æ™‚ï¼Œè‡ªå‹•åŒæ­¥æ›´æ–° Users è¡¨çš„è³‡æ–™

## ğŸ“ å‰ç«¯å¯¦ä½œå»ºè­°

### ç”³è«‹è¡¨å–®è‡ªå‹•å¡«å……

```javascript
// å–å¾—ç•¶å‰ç™»å…¥ä½¿ç”¨è€…è³‡è¨Š
fetch('/api/v1/users/me', {
    headers: {'Authorization': `Bearer ${token}`}
})
.then(res => res.json())
.then(user => {
    // è‡ªå‹•å¡«å…¥ Email å’Œå§“å
    document.getElementById('email').value = user.email;
    document.getElementById('full_name').value = user.full_name;
    
    // èº«åˆ†è­‰å’Œæ‰‹æ©Ÿéœ€è¦ä½¿ç”¨è€…å¡«å¯«
    // ä½†å¦‚æœå·²æœ‰çœŸå¯¦è³‡æ–™ï¼ˆä¸æ˜¯ GOOGLE_ é–‹é ­ï¼‰ï¼Œä¹Ÿå¯ä»¥è‡ªå‹•å¡«å…¥
    if (!user.id_number.startsWith('GOOGLE_')) {
        document.getElementById('id_number').value = user.id_number;
    }
    if (user.phone) {
        document.getElementById('phone').value = user.phone;
    }
});
```

### æç¤ºä½¿ç”¨è€…å¡«å¯«å¿…å¡«æ¬„ä½

```javascript
if (user.id_number.startsWith('GOOGLE_')) {
    showNotification('è«‹å¡«å¯«æ‚¨çš„èº«åˆ†è­‰å­—è™Ÿå’Œæ‰‹æ©Ÿè™Ÿç¢¼ä»¥å®Œæˆç”³è«‹');
}
```

## ğŸ”’ å®‰å…¨æ€§è€ƒé‡

1. **èº«åˆ†è­‰æ ¼å¼é©—è­‰**ï¼šå‰ç«¯å’Œå¾Œç«¯éƒ½è¦é©—è­‰èº«åˆ†è­‰æ ¼å¼
2. **æ‰‹æ©Ÿæ ¼å¼é©—è­‰**ï¼šç¢ºä¿æ‰‹æ©Ÿè™Ÿç¢¼æ ¼å¼æ­£ç¢º
3. **é‡è¤‡ç”³è«‹æª¢æŸ¥**ï¼šç”¨çœŸå¯¦èº«åˆ†è­‰æª¢æŸ¥æ˜¯å¦é‡è¤‡ç”³è«‹
4. **è³‡æ–™åŠ å¯†**ï¼šæ•æ„Ÿè³‡æ–™å‚³è¼¸ä½¿ç”¨ HTTPS

## ğŸ§ª æ¸¬è©¦æµç¨‹

```bash
# 1. å•Ÿå‹•ä¼ºæœå™¨
uvicorn main:app --reload

# 2. Google ç™»å…¥
open http://localhost:8000/static/google_login_test.html

# 3. æŸ¥çœ‹å»ºç«‹çš„ä½¿ç”¨è€…
# åˆ° Supabase Dashboard â†’ users è¡¨
# æ‡‰è©²çœ‹åˆ° id_number ç‚º "GOOGLE_xxx"

# 4. å¡«å¯«ç”³è«‹è¡¨å–®
open http://localhost:8000/static/applicant.html
# å¡«å¯«çœŸå¯¦èº«åˆ†è­‰å’Œæ‰‹æ©Ÿè™Ÿç¢¼

# 5. æäº¤å¾Œå†æ¬¡æŸ¥çœ‹ users è¡¨
# id_number æ‡‰è©²å·²æ›´æ–°ç‚ºçœŸå¯¦èº«åˆ†è­‰
# is_verified æ‡‰è©²ç‚º true
```

## âœ¨ ç¸½çµ

Google ç™»å…¥çš„ä½¿ç”¨è€…è³‡æ–™æ›´æ–°æ˜¯**ç„¡ç¸«ä¸”è‡ªå‹•**çš„ï¼š

1. ç™»å…¥æ™‚ï¼šå»ºç«‹å¸³è™Ÿï¼Œä½¿ç”¨è‡¨æ™‚æ¨™è¨˜
2. ç”³è«‹æ™‚ï¼šå¡«å¯«çœŸå¯¦è³‡æ–™
3. æäº¤æ™‚ï¼šè‡ªå‹•æ›´æ–°ä½¿ç”¨è€…è³‡æ–™
4. å®Œæˆå¾Œï¼šè³‡æ–™å®Œæ•´ä¸”ä¸€è‡´

ä½¿ç”¨è€…é«”é©—æµæš¢ï¼Œç„¡éœ€é¡å¤–çš„ã€Œè£œå……è³‡æ–™ã€æ­¥é©Ÿï¼ğŸ‰
